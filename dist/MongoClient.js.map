{"version":3,"sources":["../src/MongoClient.js"],"names":[],"mappings":"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","file":"MongoClient.js","sourcesContent":[" \"use strict\";\n\n import utilities from './utilities.js';\n import collectionUtil from './collectionUtil.js';\n var Mongo = require(\"mongodb\").MongoClient;\n var _ = require(\"underscore\");\n\n export class MongoClient extends Mongo {\n\n \tconstructor() {\n \t\tsuper();\n \t\tthis.db = null;\n \t}\n\n \t_dbConnect(url) {\n    var _this = this;\n \t\tMongo.connect(url, function(err, db) {\n      if (err) throw err;\n      db.collection('users').ensureIndex( { \"email\": 1 }, { unique: true } );\n      _this.db = db\n \t\t});\n \t}\n\n\n  _loadCollection(name) {\n \t\tvar promise = new Promise(\n \t\t\t(resolve, reject) => {\n \t\t\t\tthis.db.collection(name, (err, collection) => {\n \t\t\t\t\tif (err)\n \t\t\t\t\t\treject(err);\n \t\t\t\t\telse\n \t\t\t\t\t\tresolve(collection);\n \t\t\t\t});\n \t\t\t}\n \t\t);\n \t\treturn promise;\n \t}\n\n  _save(name,obj) {\n    var promise = new Promise(\n      (resolve, reject) => {\n        this.db.collection(name).insertOne(obj, (err,resp) => {\n          //check for duplicate entry\n          if (err !== null ) {\n            reject({err: err, message: \"looks like that email is already taken\" })\n          } else {\n            resolve(resp.ops[0]);\n          }\n        });\n      }\n    );\n    return promise;\n  }\n\n \t_getData(path) {\n \t\tvar promise = new Promise((resolve, reject) => {\n\n \t\t\tthis._propagateQuery(path).then((resolveObj) => {\n \t\t\t\tvar collection = resolveObj.collection;\n \t\t\t\tvar mongoQuery = resolveObj.mongoQuery;\n\n \t\t\t\tcollection.find(mongoQuery).toArray((err, docs) => {\n\n \t\t\t\t\tconsole.log(err)\n \t\t\t\t\tdocs = (docs);\n\n \t\t\t\t\tif (err) reject({\n \t\t\t\t\t\t\"code\": 500,\n \t\t\t\t\t\t\"body\": err\n \t\t\t\t\t});\n\n \t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\"code\": 200,\n \t\t\t\t\t\t\"body\": docs\n \t\t\t\t\t};\n \t\t\t\t\tresolve(responseData);\n \t\t\t\t});\n\n \t\t\t}, (err) => {\n \t\t\t\tvar responseData = {\n \t\t\t\t\t\"code\": 500,\n \t\t\t\t\t\"body\": err\n \t\t\t\t};\n \t\t\t\treject(responseData);\n \t\t\t});\n \t\t});\n \t\treturn promise;\n \t}\n\n \tdelData(path) {\n\n \t\tvar promise = new Promise((resolve, reject) => {\n\n \t\t\tpropagateQuery(path).then((resolveObj) => {\n \t\t\t\tvar collection = resolveObj.collection;\n \t\t\t\tvar mongoQuery = resolveObj.mongoQuery;\n\n \t\t\t\tcollection.deleteMany(mongoQuery, (err, result) => {\n \t\t\t\t\tif (err) reject({\n \t\t\t\t\t\t\"code\": 500,\n \t\t\t\t\t\t\"body\": err\n \t\t\t\t\t});\n\n \t\t\t\t\tvar numDocsDeleted = result.deletedCount;\n \t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\"code\": 200,\n \t\t\t\t\t\t\"body\": \"Deleteted \" + numDocsDeleted + \" documents.\"\n \t\t\t\t\t};\n \t\t\t\t\tresolve(responseData);\n \t\t\t\t});\n \t\t\t}, (err) => {\n \t\t\t\tvar responseData = {\n \t\t\t\t\t\"code\": 500,\n \t\t\t\t\t\"body\": err\n \t\t\t\t};\n \t\t\t\treject(responseData);\n \t\t\t});\n \t\t});\n \t\treturn promise;\n \t}\n\n \t_propagateQuery(path) {\n \t\tvar pathArray = [];\n \t\tif (path.length % 2 === 1) path.push(\"\");\n\n \t\t// load client\n \t\tvar promise = new Promise(\n \t\t\t(resolve, reject) => {\n\n \t\t\t\tfor (var i = 0; i < path.length; i += 2) {\n \t\t\t\t\tpathArray.push([path[i], path[i + 1]]);\n \t\t\t\t}\n\n \t\t\t\tvar chain = pathArray.reduce((previous, item, index, array) => {\n\n \t\t\t\t\treturn previous.then((result) => {\n \t\t\t\t\t\tvar collectionName = item[0];\n \t\t\t\t\t\tvar query = item[1];\n\n \t\t\t\t\t\tvar mongoQuery = utilities.parseQuery(query);\n\n \t\t\t\t\t\tif (mongoQuery === null) {\n \t\t\t\t\t\t\treject(\"bad request\");\n \t\t\t\t\t\t}\n\n \t\t\t\t\t\tmongoQuery = _.extend(mongoQuery, result.fkQuery);\n\n \t\t\t\t\t\tvar promise = new Promise(\n \t\t\t\t\t\t\t(resolve, reject) => {\n \t\t\t\t\t\t\t\tthis._loadCollection(collectionName)\n \t\t\t\t\t\t\t\t\t.then((collection) => {\n \t\t\t\t\t\t\t\t\t\tif (index !== (pathArray.length - 1)) {\n \t\t\t\t\t\t\t\t\t\t\tvar cursor = collection.find(mongoQuery);\n\n \t\t\t\t\t\t\t\t\t\t\tcursor.toArray((err, docs) => {\n \t\t\t\t\t\t\t\t\t\t\t\tif (err) {\n \t\t\t\t\t\t\t\t\t\t\t\t\treject(err);\n \t\t\t\t\t\t\t\t\t\t\t\t} else {\n \t\t\t\t\t\t\t\t\t\t\t\t\tvar keys = _.pluck(docs, \"_id\");\n\n \t\t\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < keys.length; i++) {\n \t\t\t\t\t\t\t\t\t\t\t\t\t\tkeys[i] = keys[i].toString();\n \t\t\t\t\t\t\t\t\t\t\t\t\t};\n\n \t\t\t\t\t\t\t\t\t\t\t\t\tvar fkFieldName = collectionName + \"id\";\n \t\t\t\t\t\t\t\t\t\t\t\t\tvar fkQuery = {};\n \t\t\t\t\t\t\t\t\t\t\t\t\tfkQuery[fkFieldName] = {\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t$in: keys\n \t\t\t\t\t\t\t\t\t\t\t\t\t};\n \t\t\t\t\t\t\t\t\t\t\t\t\tresolve({\n \t\t\t\t\t\t\t\t\t\t\t\t\t\tdoc: docs,\n \t\t\t\t\t\t\t\t\t\t\t\t\t\tfkQuery: fkQuery\n \t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n \t\t\t\t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t\t\t\t})\n \t\t\t\t\t\t\t\t\t\t} else {\n \t\t\t\t\t\t\t\t\t\t\tvar resolveObj = {};\n \t\t\t\t\t\t\t\t\t\t\tresolveObj[\"collection\"] = collection;\n \t\t\t\t\t\t\t\t\t\t\tresolveObj[\"mongoQuery\"] = mongoQuery;\n \t\t\t\t\t\t\t\t\t\t\tresolve(resolveObj);\n \t\t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t\t});\n \t\t\t\t\t\t\t});\n \t\t\t\t\t\treturn promise;\n \t\t\t\t\t});\n \t\t\t\t}, new Promise(\n \t\t\t\t\t(resolve, reject) => { //initial value given to reduce\n \t\t\t\t\t\tvar result = {};\n \t\t\t\t\t\tresult[\"fkQuery\"] = {};\n \t\t\t\t\t\tresolve(result);\n \t\t\t\t\t}));\n\n \t\t\t\tchain.then((cursor) => {\n \t\t\t\t\t//var responseData = {\"code\": 200, \"body\": result.doc};\n \t\t\t\t\tresolve(cursor);\n \t\t\t\t}, (err) => {\n \t\t\t\t\tconsole.log('got into error clause after chain is finished' + err);\n \t\t\t\t\t//var responseData = {\"code\": 500, \"body\": err};\n \t\t\t\t\treject(err);\n \t\t\t\t});\n \t\t\t});\n \t\treturn promise;\n \t}\n\n \tupdateData(path, data) {\n\n \t\tvar collectionName = path[0];\n\n \t\tvar promise = new Promise(\n \t\t\t(resolve, reject) => {\n\n \t\t\t\tDBClient.connect(url)\n \t\t\t\t\t.then((db) => {\n \t\t\t\t\t\tDBClient.setDB(db);\n \t\t\t\t\t\treturn DBClient._loadCollection(collectionName);\n \t\t\t\t\t})\n\n \t\t\t\t.then((collection) => {\n \t\t\t\t\tconsole.log('loading collection');\n \t\t\t\t\treturn updateDataHelper(collection);\n \t\t\t\t})\n\n \t\t\t\t.then((response) => {\n\n \t\t\t\t\tvar modifiedCount = response.result.modifiedCount;\n\n \t\t\t\t\tif (modifiedCount > 0) {\n\n \t\t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\t\"code\": 200,\n \t\t\t\t\t\t\t\"body\": \"Updated \" +\n \t\t\t\t\t\t\t\tmodifiedCount +\n \t\t\t\t\t\t\t\t\" documents\"\n \t\t\t\t\t\t};\n \t\t\t\t\t} else {\n\n \t\t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\t\"code\": 204,\n \t\t\t\t\t\t\t\"body\": \"No documents updated :(\"\n \t\t\t\t\t\t};\n \t\t\t\t\t}\n \t\t\t\t\tresolve(responseData);\n \t\t\t\t}, (err) => {\n \t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\"code\": 500,\n \t\t\t\t\t\t\"body\": err.message\n \t\t\t\t\t};\n \t\t\t\t\tconsole.log(\"response data is: \" + responseData)\n \t\t\t\t\tresolve(responseData);\n \t\t\t\t});\n \t\t\t}\n \t\t);\n\n \t\treturn promise;\n\n\n \t\tfunction updateDataHelper(collection) {\n \t\t\t// remove id field from obj\n \t\t\tdelete data[\"id\"];\n\n \t\t\tif (path.length > 1) {\n \t\t\t\tvar mongoQuery = utilities.parseQuery(path[1]);\n \t\t\t}\n\n \t\t\tif (path.length == 2) {\n \t\t\t\t//TODO: need to take this out into its own function!!!\n\n \t\t\t\tvar promise = new Promise(\n \t\t\t\t\t(resolve, reject) => {\n\n \t\t\t\t\t\tcollectionUtil.updateOne(collection, mongoQuery, data)\n \t\t\t\t\t\t\t.then((result) => {\n\n \t\t\t\t\t\t\t\tresolve(result)\n\n \t\t\t\t\t\t\t}, (err) => {\n \t\t\t\t\t\t\t\tconsole.log(err);\n \t\t\t\t\t\t\t\treject(err);\n \t\t\t\t\t\t\t})\n \t\t\t\t\t}\n \t\t\t\t);\n \t\t\t\treturn promise;\n \t\t\t}\n \t\t}\n\n \t}\n\n \tsaveData(path, data, update) {\n\n \t\tvar collectionName = path[0];\n\n \t\tvar promise = new Promise(\n \t\t\t(resolve, reject) => {\n\n \t\t\t\tDBClient.connect(url)\n \t\t\t\t\t.then((db) => {\n \t\t\t\t\t\tDBClient.setDB(db);\n \t\t\t\t\t\treturn DBClient._loadCollection(collectionName);\n \t\t\t\t\t})\n\n \t\t\t\t.then((collection) => {\n \t\t\t\t\tconsole.log('loading collection');\n\n \t\t\t\t\treturn saveDataHelper(collection);\n \t\t\t\t})\n\n \t\t\t\t.then((docs) => {\n\n \t\t\t\t\tdocs = utilities.sanitizeId(docs);\n \t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\"code\": 201,\n \t\t\t\t\t\t\"body\": docs\n \t\t\t\t\t};\n \t\t\t\t\tresolve(responseData);\n\n \t\t\t\t}, (err) => {\n\n \t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\"code\": 500,\n \t\t\t\t\t\t\"body\": err.message\n \t\t\t\t\t};\n \t\t\t\t\tconsole.log(\"response data is: \" + responseData)\n \t\t\t\t\tresolve(responseData);\n \t\t\t\t});\n \t\t\t}\n \t\t);\n\n \t\treturn promise;\n\n\n \t\tfunction saveDataHelper(collection) {\n\n \t\t\tif (path.length > 1) {\n \t\t\t\tvar mongoQuery = utilities.parseQuery(path[1]);\n \t\t\t}\n\n \t\t\tif (path.length === 1) {\n \t\t\t\tvar promise = new Promise(\n \t\t\t\t\t(resolve, reject) => {\n \t\t\t\t\t\tcollection.insertOne(data, function(err, result) {\n \t\t\t\t\t\t\tif (err) {\n \t\t\t\t\t\t\t\treject(err);\n \t\t\t\t\t\t\t} else {\n \t\t\t\t\t\t\t\tresolve(result.ops[0]);\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t});\n \t\t\t\t\t}\n \t\t\t\t);\n \t\t\t\treturn promise;\n \t\t\t} else if (path.length == 2) {\n \t\t\t\t//TODO: need to take this out into its own function!!!\n\n \t\t\t\tvar promise = new Promise(\n \t\t\t\t\t(resolve, reject) => {\n \t\t\t\t\t\tcollectionUtil.updateOne(collection, mongoQuery, data)\n \t\t\t\t\t\t\t.then((result) => {\n \t\t\t\t\t\t\t\tresolve(result)\n\n \t\t\t\t\t\t\t}, (err) => {\n \t\t\t\t\t\t\t\treject(err);\n \t\t\t\t\t\t\t})\n \t\t\t\t\t}\n \t\t\t\t);\n \t\t\t\treturn promise;\n \t\t\t} else if (path.length === 3) {\n \t\t\t\tvar collectionToAddTo = path[2];\n \t\t\t\tvar parentID;\n\n \t\t\t\tvar promise = new Promise(\n \t\t\t\t\t(resolve, reject) => {\n \t\t\t\t\t\tcollectionUtil.findOne(collection, mongoQuery)\n\n \t\t\t\t\t\t.then((doc) => {\n \t\t\t\t\t\t\tparentID = doc._id.toString();\n \t\t\t\t\t\t\treturn DBClient._loadCollection(collectionToAddTo);\n \t\t\t\t\t\t})\n\n \t\t\t\t\t\t.then((collectionToAddToObj) => {\n \t\t\t\t\t\t\tvar obj = {};\n \t\t\t\t\t\t\tvar keyName = collectionName + \"id\";\n \t\t\t\t\t\t\tobj[keyName] = parentID;\n \t\t\t\t\t\t\tdata = _.extend(data, obj);\n \t\t\t\t\t\t\treturn collectionUtil.insertOne(collectionToAddToObj, data);\n \t\t\t\t\t\t})\n\n \t\t\t\t\t\t.then((result) => {\n \t\t\t\t\t\t\tresolve(result.ops[0]);\n \t\t\t\t\t\t}, (err) => {\n \t\t\t\t\t\t\treject(err);\n \t\t\t\t\t\t});\n \t\t\t\t\t}\n \t\t\t\t);\n \t\t\t\treturn promise;\n \t\t\t}\n \t\t}\n \t}\n\n };\n"]}