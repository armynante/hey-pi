{"version":3,"sources":["../src/server.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;;;;;6BAEe,kBAAkB;;wBAC3B,aAAa;;;;sBACb,QAAQ;;;;gCACA,qBAAqB;;;;2BAC1B,gBAAgB;;;;uBAClB,SAAS;;;;4BACb,cAAc;;;;0BACP,aAAa;;;;sBACjB,QAAQ;;;;;;4BAGV,kBAAkB;;;;gCACd,sBAAsB;;;;2BAC3B,iBAAiB;;;;;AAGjC,IAAI,GAAG,GAAG,2BAAS,CAAC;;;AAGpB,IAAI,KAAK,GAAG,gCAAiB,CAAC;qBACf,KAAK;;AACpB,KAAK,CAAC,UAAU,CAAC,sBAAO,QAAQ,CAAC,CAAC;;;AAGlC,GAAG,CAAC,GAAG,CAAC,yBAAO,KAAK,CAAC,CAAC,CAAC;AACvB,GAAG,CAAC,GAAG,CAAC,wBAAW,UAAU,CAAC,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;AACpD,GAAG,CAAC,GAAG,CAAC,wBAAW,IAAI,EAAE,CAAC,CAAC;;;AAG3B,IAAI,QAAQ,GAAG,SAAX,QAAQ,CAAY,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AACvC,KAAI,IAAI,GAAG,yBAAU,SAAS,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AACxC,IAAG,CAAC,UAAU,GAAG,IAAI,CAAC;AACtB,KAAI,EAAE,CAAC;CACP,CAAC;;AAEF,IAAI,SAAS,GAAG,SAAZ,SAAS,CAAY,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;AACxC,KAAI,KAAK,GAAG,GAAG,CAAC,IAAI,CAAC,KAAK,IAAI,GAAG,CAAC,KAAK,CAAC,KAAK,IAAI,GAAG,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;AAC/E,KAAI,KAAK,EAAE;AACV,4BAAI,MAAM,CAAC,KAAK,EAAE,sBAAO,MAAM,EAAE,UAAC,GAAG,EAAC,KAAK,EAAK;AAC/C,OAAI,GAAG,EAAE;AACR,OAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,+BAA+B,EAAE,CAAC,CAAC;IACnF,MAAM;AACN,OAAG,CAAC,UAAU,GAAG,KAAK,CAAC;IACvB;GACD,CAAC,CAAC;EACH,MAAM;AACN,KAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,yCAAyC,EAAE,CAAC,CAAC;EAC7F;AACD,KAAI,EAAE,CAAC;CACP,CAAA;;;AAGD,GAAG,CAAC,GAAG,CAAC,WAAW,gCAAW,CAAA;AAC9B,GAAG,CAAC,GAAG,CAAC,YAAY,4BAAO,CAAC;;;AAG5B,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;;;AAGnB,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;;;AAGlB,GAAG,CAAC,GAAG,CAAC,MAAM,2BAAM,CAAC;;AAKrB,IAAI,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC,sBAAO,IAAI,EAAE,YAAW;AAC/C,KAAI,IAAI,GAAG,MAAM,CAAC,OAAO,EAAE,CAAC,OAAO,CAAC;AACpC,KAAI,IAAI,GAAG,MAAM,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;;AAEjC,QAAO,CAAC,GAAG,CAAC,2BAA2B,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;CACrD,CAAC,CAAC","file":"server.js","sourcesContent":["\"use strict\";\n\nimport { MongoClient } from './MongoClient.js';\nimport config from './config.js';\nimport bcrypt from 'bcrypt';\nimport collectionUtil from './collectionUtil.js';\nimport utilities from './utilities.js';\nimport express from 'express';\nimport jwt from 'jsonwebtoken';\nimport bodyParser from 'body-parser';\nimport morgan from 'morgan';\n\n//routers\nimport auth from './routes/auth.js';\nimport register from './routes/register.js';\nimport api from './routes/api.js';\n\n//initialize express:\nvar app = express();\n\n//load the database\nvar Mongo = new MongoClient();\nexport default Mongo;\nMongo._dbConnect(config.mongoUrl);\n\n//setiings\napp.use(morgan('dev')); //logging\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(bodyParser.json());\n\n//middleware\nvar urlStrip = function(req, res, next) {\n\tvar path = utilities.stripPath(req.url);\n\treq.strip_path = path;\n\tnext();\n};\n\nvar checkAuth = function(req, res, next) {\n\tvar token = req.body.token || req.query.token || req.headers['x-access-token'];\n\tif (token) {\n\t\tjwt.verify(token, config.secret, (err,valid) => {\n\t\t\tif (err) {\n\t\t\t\tres.status(401).json({ success: false, message: 'Failed to authenticate token.' });\n\t\t\t} else {\n\t\t\t\treq.authorized = valid;\n\t\t\t}\n\t\t});\n\t} else {\n\t\tres.status(401).json({ success: false, message: 'Failed to provide authentication token.' });\n\t}\n\tnext();\n}\n\n//pre-auth routes\napp.use('/register', register)\napp.use('/authorize', auth);\n\n//check authentication before proceeding to api\napp.use(checkAuth);\n\n//strip path\napp.use(urlStrip);\n\n//api routes\napp.use('/api', api);\n\n\n\n\nvar server = app.listen(config.port, function() {\n\tvar host = server.address().address;\n\tvar port = server.address().port;\n\n\tconsole.log('Listening at http://%s:%s', host, port);\n});\n"]}