{"version":3,"sources":["../src/server.js"],"names":[],"mappings":"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","file":"server.js","sourcesContent":["\"use strict\";\n\nimport {MongoClient} from './MongoClient.js'\n\nconst http = require(\"http\")\nconst _ = require(\"underscore\")\nconst util = require('./utilities.js')\nconst url = 'mongodb://localhost:27017/hey-pi'\nconst DBClient = new MongoClient();\n\nvar getData = function(data) {\n\n\tDBClient.connect(url, function(err, db) {\n\n\t  console.log(\"Connected correctly to server.\");\n\n\t\tvar collection_name = data[0];\n\t\tvar query = data[1];\n\t\tvar mongoQuery = util.parseQuery(query)\n\n\t\tif (mongoQuery === null) {\n      console.log('nothing found')\n      db.close();\n      return;\n    }\n\n\t\tvar cursor = db.collection(collection_name).find(mongoQuery);\n\t\tcursor.forEach(function(doc) {\n\t\t\tif( doc !== null) {\n\t\t\t\t\tconsole.log(doc)\n\t\t\t} else {\n\t\t\t\t\tdb.close();\n\t\t\t}\n\t\t});\n  });\n}\n\nfunction saveData(path, data){\n\n\tvar collectionName = path[0];\n\n\tif (path.length === 1){\n\t\t//simple insert\n\t}\n\telse if(path.length % 2 === 0){\n\t\t//updating existing doc\n\t}\n\telse if (path.length % 2 === 1){\n\t\t//inserting doc, with a foreign key relationship\n\t}\n\telse{\n\n\t}\n\tvar keys = Object.keys(data);\n\n\tDBClient.connect(url).then(function(db){\n\t\tconsole.log('entered then func')\n\t\tdebugger;\n\t})\n\n  .catch(function(reason){\n\t\tconsole.log(reason)\n\t})\n\n\n\n\t// Mongo.connect(url, function(err, db) {\n\t// \tdb.collection(collectionName, function(err,collection){\n\n\t// \t\tif (err){\n\t// \t\t\tconsole.log(err);\n\t// \t\t\tconsole.log('theres error when calling collection')\n\t// \t\t}\n\t// \t\telse{\n\t// \t\t\tconsole.log(\"in the second find\");\n\t// \t\t\t\tdb.collection(\"schemas\", function(err,schema) {\n\n\t// \t\t\t\t\t\tresult = schema.find({\"collectionName\":collectionName})\n\n\t// \t\t\t\t\t\tresult.forEach(function(doc){\n\t// \t\t\t\t\t\t\t\tif( doc != null) {\n\t// \t\t\t\t\t\t\t\t\t\tvar diff = _.difference(keys,doc.fields);\n\t// \t\t\t\t\t\t\t\t\t\tif (diff.length > 0) {\n\t// \t\t\t\t\t\t\t\t\t\t\t\tdoc.fields = diff.concat(doc.fields);\n\t// \t\t\t\t\t\t\t\t\t\t\t\tdebugger;\n\t// \t\t\t\t\t\t\t\t\t\t\t\tschema.updateOne({\"collectionName\":collectionName}, {$set: {\"fields\":doc.fields}},  function(err) {\n\t// \t\t\t\t\t\t\t\t\t\t\t\t\t\tif (err) throw err;\n\t// \t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"Schema updated\")\n\t// \t\t\t\t\t\t\t\t\t\t\t\t});\n\t// \t\t\t\t\t\t\t\t\t\t}\n\t// \t\t\t\t\t\t\t\t}\n\n\t// \t\t\t\t\t\t});\n\t// \t\t\t\t})\n\t// \t\t\tcollection.insertOne(data, function(err, data){\n\t// \t\t\t  if (err)\n\t// \t\t  \t  throw err;\n\t// \t\t    else\n\t// \t\t\t    console.log('data saved properly');\n\t// \t\t\t});\n\t// \t\t}\n\t// \t});\n\n\t// });\n}\n\nvar server = http.createServer(function(req, resp) {\n\n\tif (req.url!==\"/favicon.ico\"){\n\t\tswitch(req.method){\n\t\t\tcase \"GET\":\n\t\t\t\tvar path = util.stripPath(req.url);\n\t\t\t\titems = getData(path);\n\t\t\t\tresp.end(items);\n\t\t\t\tbreak;\n\t\t\tcase \"POST\":\n\t\t\t\tvar data = \"\";\n\t\t\t\tvar path = util.stripPath(req.url);\n\t\t\t\treq.on('data', function(chunk){\n\t\t\t\t\tconsole.log('received data', chunk)\n\t\t\t\t\tdata+=chunk;\n\t\t\t\t});\n\t\t\t\treq.on('end', function(){\n\t\t\t\t\tdata = JSON.parse(data);\n\t\t\t\t\tresp = saveData(path, data);\n\t\t\t\t});\n\n\t\t\t\tif (resp)\n\t\t\t\t\tresp.end(\"saved properly, yay!\")\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n});\n\nserver.listen(8000, function(){\n\tconsole.log(\"Server listening on: http://localhost:8000\");\n});\n"]}